# Frontend Service

> i-room 프로젝트의 React 기반 이중 웹 애플리케이션 서비스

> 목차
> - [📄 서비스 소개](#서비스-소개)
> - [🧑‍💻 개발자](#개발자)
> - [💻 서비스 개발 주안점](#서비스-개발-주안점)
> - [🚀 시작 가이드](#시작-가이드)
> - [⚙️ 기술 스택](#기술-스택)
> - [🏗️ 아키텍처](#아키텍처)
> - [📋 주요 기능](#주요-기능)
> - [🌐 환경별 설정](#환경별-설정)

<a id="서비스-소개"></a>

## 📄 서비스 소개

i-room 프로젝트의 React 기반 이중 웹 애플리케이션 서비스입니다. 단일 코드베이스에서 **관리자용**과 **근로자용** 두 개의 독립적인 애플리케이션을 환경변수 기반으로 빌드하며,
STOMP/WebSocket을 통한 실시간 통신과 모듈화된 컴포넌트 아키텍처로 구성되어 있습니다.

### 핵심 기능

#### 🏢 관리자 애플리케이션 (`/admin`)

- **종합 대시보드**: 현장 전체 상황, 근로자 상태, 사고 통계 등을 실시간으로 시각화
- **실시간 모니터링**: 센서 데이터, GPS 위치, PPE 착용 상태 등을 WebSocket을 통해 실시간 모니터링
- **근로자 관리**: 근로자 등록/수정, 출입 관리, 교육 이력 관리, 개인 상세 정보 조회
- **도면 및 위험구역 관리**: 현장 도면 업로드, 위험구역 설정, 동적 위험도 분석
- **AI 기반 문서 처리**: PDF 업로드 및 AI 챗봇을 통한 문서 기반 질의응답
- **보고서 생성**: 사고 이력, 근무 통계, 안전 지표 등 종합 보고서 생성

#### 👷 근로자 애플리케이션 (`/worker`)

- **실시간 안전 알림**: PPE 미착용, 위험구역 접근, 건강 위험 등 개인별 맞춤 알림
- **개인 안전 정보**: 출입 현황, 교육 이력, 안전 점수 등 개인 안전 관련 정보 조회
- **모바일 최적화**: 웨어러블 기기 및 모바일 환경에 최적화된 UI/UX
- **진동 알림**: 모바일 기기의 진동 기능을 활용한 긴급 알림

<a id="개발자"></a>

## 🧑‍💻 개발자

|             | 이성훈                                                      | 배소정                                                   | 박소연                                                     |
|-------------|----------------------------------------------------------|-------------------------------------------------------|---------------------------------------------------------|
| **E-Mail**  | p.plue1881@gmail.com                                     | bsj9278@gmail.com                                     | gumza9go@gmail.com                                      |
| **GitHub**  | [NextrPlue](https://github.com/NextrPlue)                | [BaeSJ1](https://github.com/BaeSJ1)                   | [sorasol9](https://github.com/sorasol9)                 |
| **Profile** | <img src="https://github.com/NextrPlue.png" width=100px> | <img src="https://github.com/BaeSJ1.png" width=100px> | <img src="https://github.com/sorasol9.png" width=100px> |

<a id="서비스-개발-주안점"></a>

## 💻 서비스 개발 주안점

### 📌 이중 애플리케이션 아키텍처

> `REACT_APP_MODE` 환경변수 기반으로 관리자용(`App.js`)과 근로자용(`WorkerApp.js`) 애플리케이션을 단일 코드베이스에서 조건부 빌드합니다. `index.js`에서 런타임에 적절한 앱을
로드하여 코드 재사용성과 유지보수성을 극대화하면서도 각 사용자 유형에 최적화된 UI/UX를 제공합니다.

### 📌 실시간 통신 기반 반응형 시스템

> STOMP/WebSocket 프로토콜을 통한 실시간 양방향 통신으로 알림, 센서 데이터, 모니터링 정보를 즉시 전달합니다. `alarmStompService`와 `sensorStompService`를 통해 세션
기반 개인별 알림과 관리자용 전체 모니터링을 구분하여 처리하며, 자동 재연결과 에러 핸들링으로 안정성을 보장합니다.

### 📌 GPS ↔ 캔버스 좌표 변환 시스템

> Blueprint 경계값 기반 좌표 변환 로직으로 실제 GPS 좌표를 캔버스 상의 위치로 정확히 매핑합니다. 선형 변환과 Y축 반전 처리를 통해 도면 위의 정확한 위치를 계산하며, 
미터 단위를 픽셀로 변환하는 비율 계산으로 실제 건물 크기에 맞는 시각적 표현을 제공합니다.

### 📌 API 호출 및 에러 처리 표준화

> 통합 API 서비스(`api/api.js`)를 통해 일관된 HTTP 통신 패턴을 제공합니다. JWT 토큰 자동 첨부, FormData 업로드 전용 함수 분리, 표준화된 에러 핸들링으로 
API 호출의 안정성과 유지보수성을 보장합니다.

### 📌 CSS Modules 기반 반응형 디자인

> 모든 스타일링에 CSS Modules을 적용하여 스타일 격리와 재사용성을 보장합니다. `@media` 쿼리를 통한 다단계 반응형 브레이크포인트(480px, 768px, 1024px, 1200px)로 
데스크톱부터 모바일까지 일관된 사용자 경험을 제공하며, 관리자/근로자 웹 모두 동일한 디자인 시스템을 공유합니다.

<a id="시작-가이드"></a>

## 🚀 시작 가이드

### 사전 준비 사항

- Node.js (v16 이상)
- npm

### 서비스 실행 (개발 모드)

1. **프로젝트 클론 및 디렉토리 이동**
   ```bash
   git clone {저장소 URL}
   cd i-room/frontend
   ```

2. **필요 패키지 설치**
   ```bash
   npm install
   ```

3. **환경 변수 설정**
   ```bash
   # .env 파일 생성 (옵션)
   REACT_APP_API_URL=http://localhost:8080/api
   REACT_APP_WS_URL=http://localhost:8084/alarm/ws
   REACT_APP_SENSOR_WS_URL=http://localhost:8085/sensor/ws
   ```

4. **개발 서버 실행**

    - **관리자 애플리케이션 실행:**
      ```bash
      npm start
      ```
      (`http://localhost:3000/admin`에서 확인)

    - **근로자 애플리케이션 실행:**
      ```bash
      npm run start:worker
      ```
      (`http://localhost:3001/worker`에서 확인)

<a id="기술-스택"></a>

## ⚙️ 기술 스택

- **React 19.1**: UI 라이브러리 (최신 버전)
- **JavaScript (ES6+)**: 프로그래밍 언어
- **React Router DOM 7**: 클라이언트 사이드 라우팅
- **Axios**: HTTP 클라이언트 및 API 통신
- **STOMP.js + SockJS**: WebSocket 실시간 통신
- **CSS Modules**: 모듈화된 CSS 스타일링
- **Lucide React**: 아이콘 라이브러리
- **Cross-env**: 크로스 플랫폼 환경변수 설정
- **Nginx**: 웹 서버 (프로덕션 환경)
- **Docker**: 컨테이너화 배포

<a id="아키텍처"></a>

## 🏗️ 아키텍처

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│  Browser Admin  │    │ Frontend Service │    │  API Gateway    │
│                 │    │                  │    │                 │
│ - Dashboard     │◄──►│ ┌──────────────┐ │◄──►│ - JWT Auth      │
│ - Monitoring    │    │ │    App.js    │ │    │ - Routing       │
│ - Management    │    │ │   (Admin)    │ │    └─────────────────┘
│ - Report gen    │    │ └──────────────┘ │            ▲
└─────────────────┘    │        │         │            │
                       │ ┌──────────────┐ │            ▼
                       │ │  STOMP/WS    │ │    ┌─────────────────┐
┌─────────────────┐    │ │  Services    │ │    │  Microservices  │
│ Browser Worker  │    │ └──────────────┘ │    └─────────────────┘
│                 │    │        │         │
│ - Safety Alert  │◄──►│ ┌──────────────┐ │
│ - Personal Info │    │ │ WorkerApp.js │ │
│ - Mobile UI     │    │ │   (Worker)   │ │
└─────────────────┘    │ └──────────────┘ │
                       └──────────────────┘
```

<a id="주요-기능"></a>

## 📋 주요 기능

### 1. 관리자 애플리케이션 기능

#### 대시보드 (`/dashboard`)

- **실시간 현황판**: 전체 근로자 수, 위험 상황, 장비 상태 등 주요 지표
- **사고 통계**: 시간대별, 유형별 사고 발생 현황 및 트렌드 분석
- **실시간 알림**: 긴급 상황 발생시 즉시 알림 및 대응 가능한 액션 버튼

#### 실시간 모니터링 (`/monitoring`)

- **센서 데이터 모니터링**: 근로자별 심박수, GPS 위치, 움직임 데이터 실시간 추적
- **지도 기반 위치 추적**: 현장 지도 위에 근로자 위치 실시간 표시
- **위험 상황 감지**: 이상 패턴 자동 감지 및 경고 알림

#### 근로자 관리 (`/worker`, `/worker/:id`)

- **근로자 등록/수정**: 개인 정보, 연락처, 혈액형 등 상세 정보 관리
- **출입 관리**: 체크인/체크아웃 현황 및 근무 시간 추적
- **교육 이력**: 안전 교육 수료 현황 및 재교육 스케줄 관리

#### 도면 관리 (`/blueprint`)

- **현장 도면 업로드**: 건설 현장 도면 이미지 업로드 및 관리
- **위험구역 설정**: 도면 위에 위험구역 좌표 설정 및 시각화

#### 위험구역 관리 (`/risk`)

- **동적 위험구역**: GPS 기반 실시간 위험구역 모니터링
- **접근 알림**: 근로자가 위험구역 접근시 자동 알림 발송

#### 보고서 (`/report`)

- **종합 안전 보고서**: 기간별 사고 현황, 안전 지표, 개선사항 분석
- **AI 문서 처리**: PDF 문서 업로드 및 AI 챗봇 질의응답

### 2. 근로자 애플리케이션 기능

#### 개인 대시보드 (`/home`)

- **개인 안전 현황**: 출입 상태, 교육 이수율, 안전 점수
- **오늘의 안전 정보**: 현장별 안전 수칙 및 주의사항

#### 실시간 안전 알림

- **PPE 미착용 알림**: 안전모, 안전고리 미착용시 즉시 알림
- **위험구역 접근 알림**: 위험구역 진입시 경고 메시지 및 진동
- **건강 위험 알림**: 심박수 이상, 온열질환 위험 등 건강 관련 경고

### 3. 실시간 통신 시스템

#### WebSocket 연결 관리

- **자동 재연결**: 네트워크 단절시 자동 재연결 시도
- **세션 기반 개인화**: 각 근로자별 개별 WebSocket 세션 관리
- **토큰 기반 인증**: JWT 토큰을 통한 안전한 WebSocket 연결

#### 알림 시스템

- **알림 유형 분류**: PPE_VIOLATION, DANGER_ZONE, HEALTH_RISK 등 유형별 처리
- **메시지 파싱**: 서버에서 전송된 알림 메시지를 구조화된 데이터로 변환
- **시각적/촉각적 알림**: 브라우저 알림, 모바일 진동 등 다중 알림 채널

<a id="환경별-설정"></a>

## 🌐 환경별 설정

### 로컬 개발 환경

- **관리자 앱**: `localhost:3000/admin`
- **근로자 앱**: `localhost:3001/worker`
- **API 연결**: `localhost:8080` (게이트웨이)
- **WebSocket**: `localhost:8084`, `localhost:8085`

### Docker 빌드 환경

#### 관리자 애플리케이션

```dockerfile
# Dockerfile 사용
ENV REACT_APP_MODE=admin
ENV PUBLIC_URL=/admin
```

#### 근로자 애플리케이션

```dockerfile
# Dockerfile.worker 사용
ENV REACT_APP_MODE=worker
ENV PUBLIC_URL=/worker
```

### Kubernetes 배포

- **관리자 서비스**: `frontend-deployment.yaml`
- **근로자 서비스**: `worker-deployment.yaml`
- **Nginx 설정**: 각각 별도의 nginx 설정 파일
- **Ingress 라우팅**: `/admin/*` → 관리자 앱, `/worker/*` → 근로자 앱
